<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Kenneth E. Shirley" />

<meta name="date" content="2016-01-12" />

<title>Summary Trees Example: Math Genealogy Tree</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css,body%20%7B%0A%20%20background%2Dcolor%3A%20%23fff%3B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20max%2Dwidth%3A%20700px%3B%0A%20%20overflow%3A%20visible%3B%0A%20%20padding%2Dleft%3A%202em%3B%0A%20%20padding%2Dright%3A%202em%3B%0A%20%20font%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0A%20%20font%2Dsize%3A%2014px%3B%0A%20%20line%2Dheight%3A%201%2E35%3B%0A%7D%0A%0A%23header%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0A%0A%23TOC%20%7B%0A%20%20clear%3A%20both%3B%0A%20%20margin%3A%200%200%2010px%2010px%3B%0A%20%20padding%3A%204px%3B%0A%20%20width%3A%20400px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20border%2Dradius%3A%205px%3B%0A%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20font%2Dsize%3A%2013px%3B%0A%20%20line%2Dheight%3A%201%2E3%3B%0A%7D%0A%20%20%23TOC%20%2Etoctitle%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%20%20font%2Dsize%3A%2015px%3B%0A%20%20%20%20margin%2Dleft%3A%205px%3B%0A%20%20%7D%0A%0A%20%20%23TOC%20ul%20%7B%0A%20%20%20%20padding%2Dleft%3A%2040px%3B%0A%20%20%20%20margin%2Dleft%3A%20%2D1%2E5em%3B%0A%20%20%20%20margin%2Dtop%3A%205px%3B%0A%20%20%20%20margin%2Dbottom%3A%205px%3B%0A%20%20%7D%0A%20%20%23TOC%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dleft%3A%20%2D2em%3B%0A%20%20%7D%0A%20%20%23TOC%20li%20%7B%0A%20%20%20%20line%2Dheight%3A%2016px%3B%0A%20%20%7D%0A%0Atable%20%7B%0A%20%20margin%3A%201em%20auto%3B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dcolor%3A%20%23DDDDDD%3B%0A%20%20border%2Dstyle%3A%20outset%3B%0A%20%20border%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0A%20%20border%2Dwidth%3A%202px%3B%0A%20%20padding%3A%205px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0A%20%20border%2Dwidth%3A%201px%3B%0A%20%20border%2Dstyle%3A%20inset%3B%0A%20%20line%2Dheight%3A%2018px%3B%0A%20%20padding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0A%20%20border%2Dleft%2Dstyle%3A%20none%3B%0A%20%20border%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Ap%20%7B%0A%20%20margin%3A%200%2E5em%200%3B%0A%7D%0A%0Ablockquote%20%7B%0A%20%20background%2Dcolor%3A%20%23f6f6f6%3B%0A%20%20padding%3A%200%2E25em%200%2E75em%3B%0A%7D%0A%0Ahr%20%7B%0A%20%20border%2Dstyle%3A%20solid%3B%0A%20%20border%3A%20none%3B%0A%20%20border%2Dtop%3A%201px%20solid%20%23777%3B%0A%20%20margin%3A%2028px%200%3B%0A%7D%0A%0Adl%20%7B%0A%20%20margin%2Dleft%3A%200%3B%0A%7D%0A%20%20dl%20dd%20%7B%0A%20%20%20%20margin%2Dbottom%3A%2013px%3B%0A%20%20%20%20margin%2Dleft%3A%2013px%3B%0A%20%20%7D%0A%20%20dl%20dt%20%7B%0A%20%20%20%20font%2Dweight%3A%20bold%3B%0A%20%20%7D%0A%0Aul%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%7D%0A%20%20ul%20li%20%7B%0A%20%20%20%20list%2Dstyle%3A%20circle%20outside%3B%0A%20%20%7D%0A%20%20ul%20ul%20%7B%0A%20%20%20%20margin%2Dbottom%3A%200%3B%0A%20%20%7D%0A%0Apre%2C%20code%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20color%3A%20%23333%3B%0A%7D%0Apre%20%7B%0A%20%20white%2Dspace%3A%20pre%2Dwrap%3B%20%20%20%20%2F%2A%20Wrap%20long%20lines%20%2A%2F%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20margin%3A%205px%200px%2010px%200px%3B%0A%20%20padding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0A%20%20background%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0A%0Acode%20%7B%0A%20%20font%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0A%20%20font%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0A%20%20padding%3A%202px%200px%3B%0A%7D%0A%0Adiv%2Efigure%20%7B%0A%20%20text%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0A%20%20background%2Dcolor%3A%20%23FFFFFF%3B%0A%20%20padding%3A%202px%3B%0A%20%20border%3A%201px%20solid%20%23DDDDDD%3B%0A%20%20border%2Dradius%3A%203px%3B%0A%20%20border%3A%201px%20solid%20%23CCCCCC%3B%0A%20%20margin%3A%200%205px%3B%0A%7D%0A%0Ah1%20%7B%0A%20%20margin%2Dtop%3A%200%3B%0A%20%20font%2Dsize%3A%2035px%3B%0A%20%20line%2Dheight%3A%2040px%3B%0A%7D%0A%0Ah2%20%7B%0A%20%20border%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20padding%2Dbottom%3A%202px%3B%0A%20%20font%2Dsize%3A%20145%25%3B%0A%7D%0A%0Ah3%20%7B%0A%20%20border%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0A%20%20padding%2Dtop%3A%2010px%3B%0A%20%20font%2Dsize%3A%20120%25%3B%0A%7D%0A%0Ah4%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0A%20%20margin%2Dleft%3A%208px%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Ah5%2C%20h6%20%7B%0A%20%20border%2Dbottom%3A%201px%20solid%20%23ccc%3B%0A%20%20font%2Dsize%3A%20105%25%3B%0A%7D%0A%0Aa%20%7B%0A%20%20color%3A%20%230033dd%3B%0A%20%20text%2Ddecoration%3A%20none%3B%0A%7D%0A%20%20a%3Ahover%20%7B%0A%20%20%20%20color%3A%20%236666ff%3B%20%7D%0A%20%20a%3Avisited%20%7B%0A%20%20%20%20color%3A%20%23800080%3B%20%7D%0A%20%20a%3Avisited%3Ahover%20%7B%0A%20%20%20%20color%3A%20%23BB00BB%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%20%20a%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0A%20%20%20%20text%2Ddecoration%3A%20underline%3B%20%7D%0A%0A%2F%2A%20Class%20described%20in%20https%3A%2F%2Fbenjeffrey%2Ecom%2Fposts%2Fpandoc%2Dsyntax%2Dhighlighting%2Dcss%0A%20%20%20Colours%20from%20https%3A%2F%2Fgist%2Egithub%2Ecom%2Frobsimmons%2F1172277%20%2A%2F%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Keyword%20%2A%2F%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%2F%2A%20DataType%20%2A%2F%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%2F%2A%20DecVal%20%28decimal%20values%29%20%2A%2F%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20BaseN%20%2A%2F%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Float%20%2A%2F%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20Char%20%2A%2F%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%2F%2A%20String%20%2A%2F%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%2F%2A%20Comment%20%2A%2F%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%2F%2A%20OtherToken%20%2A%2F%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20AlertToken%20%2A%2F%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%2F%2A%20Function%20calls%20%2A%2F%20%0Acode%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%2F%2A%20ErrorTok%20%2A%2F%0A%0A" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">Summary Trees Example: Math Genealogy Tree</h1>
<h4 class="author"><em>Kenneth E. Shirley</em></h4>
<h4 class="date"><em>2016-01-12</em></h4>
</div>


<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>This vignette demonstrates how to compute and visualize maximum entropy summary trees. Maximum entropy summary trees are a useful way to summarize and visualize a data set that can be represented by a rooted, node-weighted trees, where the node weights are non-negative.</p>
<p>One such data set is the Math Genealogy Tree, which is hosted and managed by the <a href="http://genealogy.math.ndsu.nodak.edu/">Math Genealogy Project</a>. The Math genealogy tree contains information about the advisor-student relationships between mathematicians and scientists in related fields (such as statistics) who have, at some point in history, earned a Ph.D. Technically, the math genealogy tree is not a tree, since some students have multiple advisors (for more on this, see <a href="http://genealogy.math.ndsu.nodak.edu/extrema.php">here</a>), but we forced the graph to be a tree by assigning each student to their primary advisor (thus removing some edges of the graph). The MGP has kindly agreed to allow us to share a sample from their data: the subtree rooted at Carl Gauss. For more on this sample of data, see <code>help(&quot;Gauss&quot;, package = &quot;summarytrees&quot;)</code>.</p>
<p>First, load the package and the Gauss data:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(summarytrees)</code></pre>
<pre><code>#&gt; Loading required package: RJSONIO
#&gt; Loading required package: RColorBrewer
#&gt; Loading required package: servr</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(Gauss)
<span class="kw">dim</span>(Gauss)</code></pre>
<pre><code>#&gt; [1] 43527     4</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(Gauss)</code></pre>
<pre><code>#&gt;   node parent weight                                   label
#&gt; 1    1      0      1                     Carl Friedrich Gauß
#&gt; 2    2      1      1        Georg Friedrich Bernhard Riemann
#&gt; 3    3      1      1 J. W. Richard (Julius Wilhelm) Dedekind
#&gt; 4    4      1      1                 Johann Benedict Listing
#&gt; 5    5      1      1                          Sophie Germain
#&gt; 6    6      1      1         Karl Georg Christian von Staudt</code></pre>
<p>There are four columns in the data frame: node, parent, weight, and label, where <code>node</code> and <code>parent</code> are non-negative integer ID numbers (with each node ID number being unique), weight is a non-negative numeric value indicating the weight of each node, and <code>label</code> is a character vector of node labels (which need not be unique). There must be exactly one element of <code>parent</code> set to 0, indicating the root node of the tree.</p>
<p>Note that Carl Gauss has 43,527 total descendants in this version of the data, which is based on a snapshot of the data from June, 2012 (and also depends on our method for edge removal to coerce the graph to a tree). We assigned a weight of one to each node (mathematician) in the tree, although you could imagine using different weight schemes to answer different questions (weights could be the number of papers written, an indicator of one’s nationality being equal to some particular country, or an indicator of one’s home university being equal to some university of interest, for example).</p>
<p>The first thing we’ll do is abbreviate the labels to the first initial + last name:</p>
<pre class="sourceCode r"><code class="sourceCode r">last &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">strsplit</span>(Gauss[, <span class="st">&quot;label&quot;</span>], <span class="st">&quot; &quot;</span>), function(x) x[<span class="kw">length</span>(x)])
first.initial &lt;-<span class="st"> </span><span class="kw">substr</span>(Gauss[, <span class="st">&quot;label&quot;</span>], <span class="dv">1</span>, <span class="dv">1</span>)
Gauss[, <span class="st">&quot;label&quot;</span>] &lt;-<span class="st"> </span><span class="kw">paste</span>(first.initial, last, <span class="dt">sep =</span> <span class="st">&quot; &quot;</span>)</code></pre>
<p>Next, we compute the maximum entropy <span class="math">\(k\)</span>-node summary trees for <span class="math">\(k = 1, 2, ..., 10\)</span> using three different versions of the algorithm. Setting a maximum size of <span class="math">\(K = 10\)</span> isn’t very realistic – this is just to illustrate the syntax for the main functions.</p>
</div>
<div id="greedy-algorithm" class="section level2">
<h2>Greedy Algorithm</h2>
<pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
g &lt;-<span class="st"> </span><span class="kw">greedy</span>(<span class="dt">node =</span> Gauss[, <span class="st">&quot;node&quot;</span>], 
            <span class="dt">parent =</span> Gauss[, <span class="st">&quot;parent&quot;</span>], 
            <span class="dt">weight =</span> Gauss[, <span class="st">&quot;weight&quot;</span>], 
            <span class="dt">label =</span> Gauss[, <span class="st">&quot;label&quot;</span>], 
            <span class="dt">K =</span> <span class="dv">10</span>)</code></pre>
<pre><code>#&gt; [1] &quot;Running order.nodes() function to prepare data&quot;
#&gt; [1] &quot;  Computing node levels&quot;
#&gt; [1] &quot;  Computing child indices for each parent&quot;
#&gt; [1] &quot;Running C function to compute summary trees&quot;
#&gt; [1] &quot;Computation finished; now formatting output&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
t2 -<span class="st"> </span>t1</code></pre>
<pre><code>#&gt; Time difference of 0.4959149 secs</code></pre>
</div>
<div id="optimal-algorithm-exact-solution" class="section level2">
<h2>Optimal Algorithm (exact solution)</h2>
<pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
e &lt;-<span class="st"> </span><span class="kw">optimal</span>(<span class="dt">node =</span> Gauss[, <span class="st">&quot;node&quot;</span>], 
             <span class="dt">parent =</span> Gauss[, <span class="st">&quot;parent&quot;</span>], 
             <span class="dt">weight =</span> Gauss[, <span class="st">&quot;weight&quot;</span>], 
             <span class="dt">label =</span> Gauss[, <span class="st">&quot;label&quot;</span>], 
             <span class="dt">K =</span> <span class="dv">10</span>, 
             <span class="dt">epsilon =</span> <span class="dv">0</span>)</code></pre>
<pre><code>#&gt; [1] &quot;Running order.nodes() function to prepare data&quot;
#&gt; [1] &quot;  Computing node levels&quot;
#&gt; [1] &quot;  Computing child indices for each parent&quot;
#&gt; [1] &quot;Running C function to compute summary trees&quot;
#&gt; [1] &quot;Computation finished; now formatting output&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
t2 -<span class="st"> </span>t1</code></pre>
<pre><code>#&gt; Time difference of 31.9972 secs</code></pre>
</div>
<div id="optimal-algorithm-approximation" class="section level2">
<h2>Optimal Algorithm (approximation)</h2>
<pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
a &lt;-<span class="st"> </span><span class="kw">optimal</span>(<span class="dt">node =</span> Gauss[, <span class="st">&quot;node&quot;</span>], 
             <span class="dt">parent =</span> Gauss[, <span class="st">&quot;parent&quot;</span>], 
             <span class="dt">weight =</span> Gauss[, <span class="st">&quot;weight&quot;</span>], 
             <span class="dt">label =</span> Gauss[, <span class="st">&quot;label&quot;</span>], 
             <span class="dt">K =</span> <span class="dv">10</span>, 
             <span class="dt">epsilon =</span> <span class="fl">0.5</span>)</code></pre>
<pre><code>#&gt; [1] &quot;Running order.nodes() function to prepare data&quot;
#&gt; [1] &quot;  Computing node levels&quot;
#&gt; [1] &quot;  Computing child indices for each parent&quot;
#&gt; [1] &quot;Running C function to compute summary trees&quot;
#&gt; [1] &quot;Computation finished; now formatting output&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
t2 -<span class="st"> </span>t1</code></pre>
<pre><code>#&gt; Time difference of 1.734827 secs</code></pre>
<p>To compare the resulting 10-node summary trees, for example, we can print them to the screen:</p>
<pre class="sourceCode r"><code class="sourceCode r">g$summary.trees[[<span class="dv">10</span>]]</code></pre>
<pre><code>#&gt;    node parent weight type       label
#&gt; 1     1      0      1    1      C Gauß
#&gt; 2     2      1      1    1   C Gerling
#&gt; 3    17      2      1    1   J Plücker
#&gt; 4    50     17      1    1     C Klein
#&gt; 5    65     50      1    1 C Lindemann
#&gt; 6     3      1   8386    2 C Gudermann
#&gt; 7   570     65  14489    2   D Hilbert
#&gt; 8    NA      1   8790    3    7 others
#&gt; 9    NA     50   6786    3   52 others
#&gt; 10   NA     65   5071    3   39 others</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">e$summary.trees[[<span class="dv">10</span>]]</code></pre>
<pre><code>#&gt;    node parent weight type       label
#&gt; 1     1      0      1    1      C Gauß
#&gt; 2     2      1      1    1   C Gerling
#&gt; 3    17      2      1    1   J Plücker
#&gt; 4    50     17      1    1     C Klein
#&gt; 5    65     50      1    1 C Lindemann
#&gt; 6     3      1   8386    2 C Gudermann
#&gt; 7   570     65  14489    2   D Hilbert
#&gt; 8    NA      1   8790    3    7 others
#&gt; 9    NA     50   6786    3   52 others
#&gt; 10   NA     65   5071    3   39 others</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">a$summary.trees[[<span class="dv">10</span>]]</code></pre>
<pre><code>#&gt;    node parent weight type       label
#&gt; 1     1      0      1    1      C Gauß
#&gt; 2     2      1      1    1   C Gerling
#&gt; 3    17      2      1    1   J Plücker
#&gt; 4    50     17      1    1     C Klein
#&gt; 5    65     50      1    1 C Lindemann
#&gt; 6     3      1   8386    2 C Gudermann
#&gt; 7   570     65  14489    2   D Hilbert
#&gt; 8    NA      1   8790    3    7 others
#&gt; 9    NA     50   6786    3   52 others
#&gt; 10   NA     65   5071    3   39 others</code></pre>
<p>The <code>summary.trees</code> object returned by <code>greedy()</code> or <code>optimal()</code> is a list of length <span class="math">\(K\)</span>, where the <span class="math">\(k^{th}\)</span> element (for <span class="math">\(k = 1, 2, ..., K\)</span>) contains the <span class="math">\(k\)</span>-node summary tree, represented as a matrix with five columns. (In the case of <code>optimal()</code> with <code>epsilon = 0</code>, the summary trees are <i>maximum entropy</i> summary trees – otherwise not necessarily.)</p>
<ol style="list-style-type: decimal">
<li>The first column contains the node ID, which is <code>NA</code> if the node in the summary tree is an ‘other’ cluster.</li>
<li>The second column contains the ID of the node’s parent.</li>
<li>The third column contains the weight of the node in the summary tree.</li>
<li>The fourth column contains the ‘type’ of node in the summary tree, where 1 indicates a singleton (whose weight in the summary tree is equal to its weight in the input tree), 2 indicates a subtree (whose weight in the summary tree is equal to the sum of the weights of the nodes in its subtree in the input tree), and 3 indicates an ‘other cluster’.</li>
<li>The fifth column contains the label, which is the same as the input label for summary tree nodes of type = 1 or type = 2, but for summary tree nodes of type 3, the label is ‘x others’ where ‘x’ indicates how many sibling nodes comprise the ‘other’ cluster.</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all.equal</span>(g$summary.trees[[<span class="dv">10</span>]], e$summary.trees[[<span class="dv">10</span>]])</code></pre>
<pre><code>#&gt; [1] TRUE</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">all.equal</span>(g$summary.trees[[<span class="dv">10</span>]], a$summary.trees[[<span class="dv">10</span>]])</code></pre>
<pre><code>#&gt; [1] TRUE</code></pre>
<p>In this case, all three 10-node summary trees are the same. In other words, for <span class="math">\(k=10\)</span>, the greedy algorithm and the approximate algorithm returned the maximum entropy summary tree (which is always the result of the exact algorithm).</p>
<p>Sometimes the greedy algorithm does not return the maximum entropy summary tree for a given data set and value of <span class="math">\(k\)</span>. This is to be expected – it is not guaranteed to find the global maximum; in practice, it runs much faster than the exact algorithm, and often returns summary trees whose entropies are very close to that of the maximum entropy summary tree.</p>
<p>The approximate algorithm is guaranteed to return a summary tree whose entropy is within <span class="math">\(\epsilon\)</span> of the global maximum entropy over all <span class="math">\(k\)</span>-node summary trees. For small values of <span class="math">\(\epsilon\)</span>, sometimes the approximation algorithm takes <i>longer</i> to run than the exact algorithm, because it rounds the weights <i>up</i>. In this case it obviously makes more sense to the the exact algorithm. We are working on a way to detect these situations in advance to avoid wasting time on a sub-optimal solution.</p>
<p>For very basic visual EDA, we recommend the greedy algorithm, purely for speed reasons. Then, based on the size of your input tree, for more accurate summaries, we recommend the approximate or exact algorithm.</p>
<p>Also note that the <code>greedy()</code> and <code>optimal()</code> functions return a list with five objects: <code>summary.trees</code>, which we have seen above and contains the list of summary trees for <span class="math">\(k = 1, 2, ..., K\)</span>, as well as four additional objects: <code>data</code>, <code>tree</code>, <code>entropy</code>, and <code>order</code>.</p>
<ul>
<li><p>The <code>data</code> object is a data frame containing the input data (node, parent, weight, and label) after having been sorted by level, and then by parent (and then by weight and label, although those last two steps aren’t absolutely necessary for the algorithm to run).</p></li>
<li><p>The <code>tree</code> object is a more compact representation of the tree’s structure: a matrix with three columns, the first identifying the node ID of each parent in the tree, and the second and third columns containing the node IDs of the first and last child of each parent (which is possible because the nodes have been sorted within each level by parent).</p></li>
<li><p>The <code>entropy</code> object is a <span class="math">\(K x 2\)</span> matrix where the second column contains the entropies of the <span class="math">\(K\)</span> summary trees that are returned.</p></li>
<li><p>The <code>order</code> object is a vector containing the ordering of the original data that matches the <code>data</code> object returned by the <code>greedy()</code> or <code>optimal()</code> function. This is so that you can reconcile your original copy of the data with the summary trees.</p></li>
</ul>
<p>Ordering of the nodes and the production of the <code>tree</code> object is currently required by the C function that does the computation of the maximum entropy summary trees. It will most likely be deprecated in the future, as it’s somewhat redundant.</p>
<p>In the current version, though, after computing maximun entropy summary trees for a given data set, you should work with the <code>data</code> object returned by the <code>greedy()</code> or <code>optimal()</code> function, whose node ID numbers agree with those in the <code>summary.trees</code> object.</p>
</div>
<div id="visualization" class="section level2">
<h2>Visualization</h2>
<p>The main reason to compute maximum entropy summary trees is to visualize them, and the visuzlizaiton is more powerful when one can interactively transition among the <span class="math">\(k\)</span>-node summary trees for <span class="math">\(k = 1, ..., K\)</span>, where typically, <span class="math">\(50 \leq K \leq 500\)</span>.</p>
<p>In this section we show how the <code>summarytrees</code> package can be used to construct a web-based interactive visualization using d3.js. The process of creating the visualization is broken into two functions: <code>prepare.vis()</code> to convert data and plotting arguments from R objects to JSON to be read by the javascript, and <code>draw.vis()</code> to open up a browser on one’s local machine to serve the visualization.</p>
<p>The <code>prepare.vis()</code> function takes ten arguments:</p>
<ol style="list-style-type: decimal">
<li><p>The first one, <code>tree.list</code>, is the list of <span class="math">\(K\)</span> summary trees that were computed by either <code>greedy()</code> or <code>optimal()</code>.</p></li>
<li><p>The second argument, <code>labels</code>, is the full vector of labels from the input tree, in order from node 1 to <span class="math">\(n\)</span>, <i>where this ordering comes from the post-processed edges</i>, which are returned to the user as the <code>data</code> attribute of the output of <code>greedy()</code> and <code>optimal()</code>.</p></li>
<li><p><code>tree</code> is the compact version of the tree, a matrix that contains the list of all unique parents in the tree, and the sequence of indices of each of their respective children.</p></li>
<li><p><code>legend.width</code> is the width, (in pixels), of the legend bar in the upper left-hand corner of the visualization, and is also used as the width and height of the entropy profile plot.</p></li>
<li><p><code>node.width</code> is the width (in pixels) of each level of the tree. The rectangular nodes themselves are scaled according to their individual weights. The <code>node.width</code> parameter must be greater than or equal to the <code>legend.width</code>.</p></li>
<li><p><code>node.height</code> is the height (in pixels) of each node.</p></li>
<li><p><code>units</code> is the designation of units that will be displayed in the legend.</p></li>
<li><p><code>print.weights</code> is a logical value for whether the weights of the summary tree nodes should be printed next to the labels.</p></li>
<li><p><code>legend.color</code> is the color of the legend bar, and is also used as the default color of the nodes if <code>color.level</code> is NULL.</p></li>
<li><p><code>color.level</code> determines whether nodes should be colored according to their ancestor at <code>color.level</code>. Often setting <code>color.level</code> to 2 or 3 helps visually track the ancestry of nodes in a summary tree with more than, say, 50 or 100 nodes.</p></li>
</ol>
<p>To demonstrate the visualization, let’s first compute a larger set of summary trees for the Gauss subtree of the MGP using the greedy algorithm (to maximize speed):</p>
<pre class="sourceCode r"><code class="sourceCode r">t1 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
g &lt;-<span class="st"> </span><span class="kw">greedy</span>(<span class="dt">node =</span> Gauss[, <span class="st">&quot;node&quot;</span>], 
            <span class="dt">parent =</span> Gauss[, <span class="st">&quot;parent&quot;</span>], 
            <span class="dt">weight =</span> Gauss[, <span class="st">&quot;weight&quot;</span>], 
            <span class="dt">label =</span> Gauss[, <span class="st">&quot;label&quot;</span>], 
            <span class="dt">K =</span> <span class="dv">200</span>)</code></pre>
<pre><code>#&gt; [1] &quot;Running order.nodes() function to prepare data&quot;
#&gt; [1] &quot;  Computing node levels&quot;
#&gt; [1] &quot;  Computing child indices for each parent&quot;
#&gt; [1] &quot;Running C function to compute summary trees&quot;
#&gt; [1] &quot;Computation finished; now formatting output&quot;</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">t2 &lt;-<span class="st"> </span><span class="kw">Sys.time</span>()
t2 -<span class="st"> </span>t1</code></pre>
<pre><code>#&gt; Time difference of 9.402706 secs</code></pre>
<p>Now we call the <code>prepare.vis()</code> function to set up the data required to visualize this set of 200 summary trees:</p>
<pre class="sourceCode r"><code class="sourceCode r">json &lt;-<span class="st"> </span><span class="kw">prepare.vis</span>(<span class="dt">tree.list =</span> g$summary.trees,
                    <span class="dt">labels =</span> g$data[, <span class="st">&quot;label&quot;</span>],
                    <span class="dt">tree =</span> g$tree,
                    <span class="dt">legend.width =</span> <span class="dv">120</span>,
                    <span class="dt">node.width =</span> <span class="dv">150</span>,
                    <span class="dt">node.height =</span> <span class="dv">12</span>,
                    <span class="dt">units =</span> <span class="st">&quot;# of descendants&quot;</span>,
                    <span class="dt">print.weights =</span> <span class="ot">TRUE</span>,
                    <span class="dt">legend.color =</span> <span class="st">&quot;lightsteelblue&quot;</span>,
                    <span class="dt">color.level =</span> <span class="dv">2</span>)</code></pre>
<p>A call to <code>prepare.vis()</code> typically only takes a few seconds to run, since by definition it is only operating on a set of summary trees (rather than potentially large input data).</p>
<p>Last, we call the function <code>draw.vis()</code> to open a browser and serve the visualization locally. It uses the <code>httd()</code> function from the <code>servr</code> package.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">draw.vis</span>(<span class="dt">json.object =</span> json,
         <span class="dt">out.dir =</span> <span class="kw">tempfile</span>(),
         <span class="dt">open.browser =</span> <span class="kw">interactive</span>())</code></pre>
<p>This visualization can be viewed at:</p>
<p><a href="http://www.kennyshirley.com/summarytrees/gauss"><a href="http://www.kennyshirley.com/summarytrees/gauss" class="uri">http://www.kennyshirley.com/summarytrees/gauss</a></a></p>
<p>A few interesting things to note are:</p>
<ol style="list-style-type: decimal">
<li><p>More than half of the descendants of Gauss are descendants of C. Gerling, one of Gauss’s nine students.</p></li>
<li><p>Gerling only has one student in the data set, Plucker, who himself only had one student in this data set, Klein. Only with Klein’s 53 students does Gerling’s branch “spread out”, where, for <span class="math">\(k = 100\)</span>, Klein has seven students that have children in the 100-node summary tree, and the rest are gathered in an “other” cluster.</p></li>
<li><p>The difference between the 53-node maximum entropy summary tree and the 54-node tree is stark. In the 53-node summary tree, the Bessel node (dark green, level two) represent the entire Bessel subtree, with 5018 descendants. With a budget of 54 nodes, however, the entropy is maximized by expanding the Bessel subtree to show nine descendants of Bessel (in addition to Bessel himself), while aggregating some of the nodes from the 53-node summary tree. This illustrates the fact that maximum entropy summary trees are not nested.</p></li>
</ol>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
